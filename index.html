<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="utf-8" />
		<meta name="description" content="Resolutor de estado de Routh" />
		<meta name="author"	content="Nadal Gonzalo GarcÃ­a Zavala" />
		<title>Resolutor de estado de Routh</title>
		<link rel="stylesheet" type="text/css" href="index.css"/>
		<script type="text/javascript" src="./Log.js"></script>
		<script type="text/javascript" src="./Mon.js"></script>
		<script type="text/javascript" src="./Exp.js"></script>
		<script type="text/javascript" src="./Factor.js"></script>
		<script type="text/javascript" src="./Interp.js"></script>
	</head>
	<body>
		<div class='cajaEq'>
			<!--
			<span>
				<p>K:</p> 
				<div>
					<input type="text" autofocus="autofocus" name="pol"/>
					<input type="text" autofocus="autofocus" name="pol"/>
				</div>
			</span>
			-->
			<span>
				<p>G(P):</p> 
				<div>
					<input type="text" value="10" autofocus="autofocus" name="pol"/>
					<input type="text" value="(x+2)*(x+3)" autofocus="autofocus" name="pol"/>
				</div>
			</span>
			<span>
				<p>H(P):</p> 
				<div>
					<input type="text" value="1" autofocus="autofocus" name="pol"/>
					<input type="text" value="x" autofocus="autofocus" name="pol"/>
				</div>
			</span>
		</div>
		<p name="res"></p>

		<script type="text/javascript">

			Inputs=document.getElementsByName("pol");
			LogOut=document.getElementsByName("res")[0];
			Expresiones=[];

			log=new Log();

			setInterval(actLog , 200);

			function actLog()
			{
				if(log.cambio&&log.enable)
				{
					LogOut.innerHTML=log.buff;

					log.cambio=0;
				}
			}

			function graficaExp(expresion)
			{
				var nP=document.createElement('p');
					nP.setAttribute('class','exp');
				if(expresion.const)
				{
					var txt=document.createTextNode(expresion.const)
					nP.appendChild(txt);
				}

				for(var k=0;k<expresion.monomios.length;k++)
				{
					var mon=expresion.monomios[k]
					var mas=''+mon.cohef;
					if(k&&mas[0]!='-')
					{
						mas='+'+mas;
					}
					var txt=document.createTextNode(mas);
					nP.appendChild(txt);

					for(var e=0;e<mon.incogs.length;e++)
					{
						var txt=document.createTextNode(mon.incogs[e]);
							nP.appendChild(txt);
						var classExpo='expo '

						if(mon[mon.incogs[e]]==1)
						{
							classExpo+=' uno';
						}
						var nSpan=document.createElement('span');
							nSpan.setAttribute('class',classExpo);

							nSpan.innerHTML+=mon[mon.incogs[e]];

							nP.appendChild(nSpan);
					}
				}

				return nP;
			}
			function tablaRouth()
			{
				var tabla=document.createElement('table');
					tabla.setAttribute('id','routh');

				 pRouth=new FactorOrd('x',Expresiones[1]);

				var str='';
				var nP=document.createElement('p');
					nP.setAttribute('id','pRouth');
				for(var i=0;i<pRouth['x'].length;i++)
				{
					var expo='<span class="expo">';
					var incog='';

					if(i>0)
					{
						incog='x';
						if(i>1)
						{
							expo+=''+i;
						}
					}

					var suma=graficaExp(pRouth['x'][i]).innerHTML+''+incog+expo+'</span>';
					if(i&&suma[0]!='-')
					{
						nP.innerHTML+='+';
					}
					nP.innerHTML+=suma;
				}
				nP.innerHTML=nP.innerHTML.substr(0,nP.innerHTML.length-1);
				document.body.appendChild(nP)

				var tRouth=pRouth.tablaRouth('x');

				for(var i=0;i<tRouth.length;i++)
				{
					if(!tRouth[i])
					{
						return 0;
					}
					var tr=document.createElement('tr');
					var td=document.createElement('td');
					var nP=document.createElement('p');

					var txt=document.createTextNode('x')
						nP.appendChild(txt);

					var expo=tRouth.length-i-1;
					var nSpan=document.createElement('span');
					var expoClass='expo';

					if(expo===1)
					{
						expoClass+=' uno';
					}
						nSpan.setAttribute('class',expoClass);
						nSpan.innerHTML=expo;
						nP.appendChild(nSpan);
						td.appendChild(nP);
						tr.appendChild(td);

					for(var j=0;j<tRouth[i].length;j++)
					{
						td=document.createElement('td');

						nP=graficaExp(tRouth[i][j]);

						td.appendChild(nP);
						tr.appendChild(td);
					}

					tabla.appendChild(tr);
				}

				nH=document.createElement('h2');
				if(pRouth.estable)
				{
					nH.innerHTML='Sistema Estable';
					nH.setAttribute('class','sEstable');
				}
				else
				{
					nH.innerHTML='Sistema Inestable';
					nH.setAttribute('class','sInestable');
				}

				document.body.appendChild(tabla);
				document.body.appendChild(nH);
			}
			function outInput()
			{
				log.enable=false;
				//log.enable=false;

				for(var i=0;i<Inputs.length;i++)
				{
					if(Inputs[i].value.length)
					{
						var interp=new Interp();

						interp.log=log;

						Expresiones[i]=interp.interpStr('('+Inputs[i].value+')');
					}
				}
				log.fn("Respuesta:");

				log.enable=false;
				for(var i=0;i<Expresiones.length;i++)
				{
					log.fn('Expresion '+i+' :');
					log.txt('Constante: '+Expresiones[i].const);

					log.array()
					log.array(Expresiones[i].monomios);
					log.array()
					log.sep();
				}

				var GPN,HPN,GPD,GPD;

				GPN=Expresiones[0];
				GPD=Expresiones[1];
				HPN=Expresiones[2];
				HPD=Expresiones[3];

				log.txt('Numerador GP X Numerador HP');
				GPN.mult(HPN);
				log.txt('Denominador GP X Denominador HP');
				GPD.mult(HPD);
				log.txt('Denominador GP + Numerador GP');
				GPD.suma(GPN);

				log.enable=false;
				tablaRouth();
			}
			
			document.getElementsByName("pol")[0].addEventListener
			(
				"keydown",
				function(event)
				{
					if(event.keyCode==13)
					{
						outInput();
					}
				}
			);
		</script>
	</body>
</html>